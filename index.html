<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regency Horror Menu</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Removed global 'cursor: crosshair'. Cursor is now managed per-page component. */
        body { margin: 0; background-color: #050505; }
        
        /* Scrollbar Hiding Hack */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }

        /* Range Slider Styling for Volume */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #34d399;
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 0 10px rgba(52, 211, 153, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #333;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        /**
         * ðŸ“œ FEATURE REGISTRY ðŸ“œ
         * ------------------------------------------------------------------
         * Trace of added/modified features to maintain project integrity.
         * Protocol: C+O+2 (Origin: Digital Denim OS).
         * Versioning: Natural Numbers.
         * * [1]..[21] - Previous Versions.
         * [22] - Depart Module: Added "Extinguish Candle" mechanic.
         * - Cursor Fix: Removed global crosshair; Buried Secrets now uses 'cursor-none'.
         * - Audio Logic: Depart page instantly silences all audio engines.
         * ------------------------------------------------------------------
         */
        const FEATURE_REGISTRY = {
          version: 22,
          date: new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' }),
          features: [
            "Regency Atmosphere",
            "Smart Animation",
            "Frost Glass UI",
            "Scarlet Cursive Editor",
            "Secret Registry (C+O+2)",
            "Midnight Waltz (Visualizer)",
            "Ghost Synth V3",
            "Buried Secrets (Lantern)",
            "Depart (Candle Mechanic)"
          ]
        };

        // --- SVG Filters ---
        const GrungeFilters = () => (
          <svg style={{ position: 'absolute', width: 0, height: 0 }}>
            <defs>
              <filter id="grunge-filter-1">
                <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5" result="noise" />
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="12" xChannelSelector="R" yChannelSelector="G" />
              </filter>
              <filter id="grunge-filter-2">
                <feTurbulence type="fractalNoise" baseFrequency="0.03" numOctaves="4" result="noise" />
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="15" xChannelSelector="R" yChannelSelector="G" />
              </filter>
            </defs>
          </svg>
        );

        // --- Secret Registry Modal ---
        const RegistryModal = ({ onClose }) => {
          return (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-[fadeIn_0.5s_ease-out]">
              <div className="relative max-w-lg w-full p-8 border border-stone-700 bg-[#0a0a0a] shadow-[0_0_50px_rgba(255,255,255,0.1)]" style={{ fontFamily: '"Courier New", monospace' }}>
                <button onClick={onClose} className="absolute top-4 right-4 text-stone-500 hover:text-white">[X]</button>
                <h3 className="text-emerald-500 text-xl mb-6 tracking-widest uppercase border-b border-stone-800 pb-2">System Registry</h3>
                <div className="space-y-4 text-stone-300 text-sm">
                  <div className="flex justify-between"><span className="text-stone-500">Version_ID:</span><span className="text-white">{FEATURE_REGISTRY.version}</span></div>
                  <div className="flex justify-between"><span className="text-stone-500">Creation_Date:</span><span className="text-white">{FEATURE_REGISTRY.date}</span></div>
                  <div className="flex justify-between"><span className="text-stone-500">Protocol:</span><span className="text-emerald-400">C+O+2 (Active)</span></div>
                  <div className="mt-6">
                    <span className="text-stone-500 block mb-2">Installed_Modules:</span>
                    <ul className="space-y-1 border-l border-stone-800 pl-4">
                      {FEATURE_REGISTRY.features.map((feat, i) => (
                        <li key={i} className="text-stone-400 hover:text-emerald-400 transition-colors">{`> ${feat}`}</li>
                      ))}
                    </ul>
                  </div>
                </div>
                <div className="mt-8 text-center text-[10px] text-stone-700 uppercase tracking-[0.5em]">Read Only Memory</div>
              </div>
            </div>
          );
        };

        // --- PAGE: Depart (The Extinguish Mechanic) ---
        const Depart = ({ onBack }) => {
            const [extinguished, setExtinguished] = useState(false);
            const [showEnd, setShowEnd] = useState(false);

            const handleExtinguish = () => {
                if (navigator.vibrate) navigator.vibrate([50, 100, 50]); // Haptic puff
                setExtinguished(true);
                setTimeout(() => setShowEnd(true), 2000);
            };

            return (
                <div className="w-full h-screen flex flex-col items-center justify-center relative overflow-hidden bg-black animate-[fadeIn_1s_ease-in-out]">
                    
                    {!extinguished ? (
                        <div className="flex flex-col items-center gap-8 animate-[fadeIn_1s_ease-out]">
                            <h2 className="text-3xl text-stone-300 font-serif tracking-widest mb-10" style={{ fontFamily: '"Playfair Display"' }}>
                                One last light...
                            </h2>
                            
                            {/* The Candle */}
                            <div 
                                onClick={handleExtinguish}
                                className="cursor-pointer group relative flex flex-col items-center"
                            >
                                {/* Flame */}
                                <div className="w-4 h-8 bg-orange-300 rounded-[50%] shadow-[0_0_40px_10px_rgba(251,146,60,0.6)] animate-[flicker_0.1s_infinite_alternate] group-hover:scale-110 transition-transform origin-bottom">
                                    <div className="w-2 h-4 bg-white rounded-[50%] opacity-80 mx-auto mt-2 blur-[1px]"></div>
                                </div>
                                {/* Wick */}
                                <div className="w-1 h-2 bg-stone-800 mt-[-2px]"></div>
                                {/* Wax */}
                                <div className="w-16 h-40 bg-stone-200 rounded-t-md shadow-inner bg-gradient-to-r from-stone-300 via-stone-100 to-stone-300"></div>
                                
                                <p className="mt-8 text-stone-600 text-xs uppercase tracking-[0.3em] opacity-0 group-hover:opacity-100 transition-opacity">
                                    Click to Extinguish
                                </p>
                            </div>

                            <button 
                                onClick={onBack}
                                className="absolute bottom-10 text-stone-700 hover:text-white transition-colors uppercase tracking-[0.2em] text-xs"
                            >
                                Return (Not yet)
                            </button>
                        </div>
                    ) : (
                        <div className="flex flex-col items-center justify-center w-full h-full animate-[fadeOut_3s_forwards]">
                            {/* Smoke Effect */}
                            <div className="absolute w-2 h-32 bg-stone-500 blur-xl opacity-20 rounded-full animate-[smoke_3s_ease-out_forwards]"></div>
                            
                            {showEnd && (
                                <h1 className="text-stone-500 font-serif text-6xl tracking-[0.5em] opacity-0 animate-[slowReveal_4s_forwards]" style={{ fontFamily: '"Cinzel"' }}>
                                    FIN
                                </h1>
                            )}
                        </div>
                    )}

                    <style>{`
                        @keyframes flicker {
                            0% { transform: scale(1) skewX(2deg); opacity: 0.9; }
                            25% { transform: scale(1.05) skewX(-2deg); opacity: 0.8; }
                            50% { transform: scale(0.95) skewX(1deg); opacity: 1; }
                            75% { transform: scale(1.02) skewX(-1deg); opacity: 0.85; }
                            100% { transform: scale(1) skewX(0deg); opacity: 0.9; }
                        }
                        @keyframes smoke {
                            0% { transform: translateY(0) scale(1); opacity: 0.4; }
                            100% { transform: translateY(-200px) scale(4); opacity: 0; }
                        }
                        @keyframes slowReveal {
                            0% { opacity: 0; transform: scale(0.9); }
                            100% { opacity: 1; transform: scale(1); }
                        }
                    `}</style>
                </div>
            );
        };

        // --- PAGE: Buried Secrets (The Lantern V2 + Cursor Fix) ---
        const BuriedSecrets = ({ onBack }) => {
            const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
            const containerRef = useRef(null);

            const handleMouseMove = (e) => {
                if (containerRef.current) {
                    const rect = containerRef.current.getBoundingClientRect();
                    setMousePos({
                        x: e.clientX - rect.left,
                        y: e.clientY - rect.top
                    });
                }
            };

            const handleArtifactHover = () => {
                if (navigator.vibrate) navigator.vibrate(10);
            };

            return (
                <div 
                    ref={containerRef}
                    onMouseMove={handleMouseMove}
                    className="w-full h-screen relative overflow-hidden bg-black cursor-none animate-[fadeIn_1s_ease-in-out]"
                >
                    {/* Hidden Content */}
                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div className="w-full max-w-4xl p-10 relative">
                            <p className="absolute top-10 left-10 text-stone-600 font-serif opacity-50 rotate-[-5deg]">"I heard them scratching..."</p>
                            <p className="absolute bottom-20 right-20 text-stone-700 font-serif opacity-40 rotate-[10deg]">"Nov 14th, 1813"</p>
                            <p className="absolute top-1/2 left-1/4 text-red-900/40 font-serif text-4xl blur-[1px]">GUILTY</p>
                            
                            <div className="text-center space-y-6">
                                <h2 className="text-4xl text-stone-300 font-serif tracking-widest" style={{ fontFamily: '"Playfair Display"' }}>
                                    The Earth Remembers
                                </h2>
                                <p className="text-stone-500 max-w-lg mx-auto font-serif italic text-lg" style={{ fontFamily: '"Cedarville Cursive", cursive' }}>
                                    We buried the truth deep beneath the floorboards, hoping the silence would take it. 
                                    But silence, my dear, is heavy. It presses down until the cracks begin to show.
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Artifacts */}
                    <div 
                        className="absolute top-1/3 right-1/4 w-12 h-12 rounded-full border border-emerald-900/50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300 cursor-pointer"
                        onMouseEnter={handleArtifactHover}
                    >
                        <span className="text-emerald-500 text-xs">â€ </span>
                    </div>

                    {/* THE LANTERN MASK */}
                    <div 
                        className="absolute inset-0 pointer-events-none z-10"
                        style={{
                            background: `radial-gradient(circle 260px at ${mousePos.x}px ${mousePos.y}px, transparent 20%, rgba(0,0,0,0.3) 40%, rgba(0,0,0,0.98) 100%)`
                        }}
                    />

                    {/* UI Overlay */}
                    <div className="absolute top-10 w-full flex justify-between items-center px-8 z-20">
                        <h2 className="text-stone-800 text-sm tracking-widest uppercase">Lantern Active</h2>
                        <button onClick={onBack} className="text-stone-500 hover:text-white transition-colors uppercase tracking-[0.2em] text-sm">Return</button>
                    </div>
                </div>
            );
        };

        // --- PAGE: The Midnight Waltz (Audio Engine) ---
        const MidnightWaltz = ({ onBack }) => {
            const [playing, setPlaying] = useState(false);
            const [synthType, setSynthType] = useState("glass");
            const [volume, setVolume] = useState(0.15);
            const [switching, setSwitching] = useState(false);
            const synthRef = useRef(null);

            const stopSynth = () => {
                if (synthRef.current) {
                    synthRef.current.voices.forEach(v => { if(v.osc) v.osc.stop(); });
                    if (synthRef.current.ctx) synthRef.current.ctx.close();
                    synthRef.current = null;
                }
            };

            const synths = {
                glass: (ctx, masterGain) => {
                    const createVoice = (freq, detune, panVal) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        const panner = ctx.createStereoPanner();
                        osc.type = "sine";
                        osc.frequency.value = freq;
                        osc.detune.value = detune;
                        gain.gain.setValueAtTime(0, ctx.currentTime);
                        gain.gain.linearRampToValueAtTime(0.8, ctx.currentTime + 2);
                        panner.pan.value = panVal;
                        osc.connect(gain); gain.connect(panner); panner.connect(masterGain);
                        osc.start();
                        return { osc, gain };
                    };
                    return [
                        createVoice(220, 0, -0.5),
                        createVoice(261.63, 5, 0.5),
                        createVoice(329.63, -5, 0)
                    ];
                },
                alarm: (ctx, masterGain) => {
                    const createVoice = (freq, type) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.type = type;
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0, ctx.currentTime);
                        gain.gain.linearRampToValueAtTime(0.6, ctx.currentTime + 0.5);
                        osc.connect(gain); gain.connect(masterGain);
                        osc.start();
                        return { osc, gain };
                    };
                    const v1 = createVoice(110, "sawtooth");
                    const v2 = createVoice(114, "triangle");
                    const lfo = ctx.createOscillator();
                    lfo.type = "square";
                    lfo.frequency.value = 8; 
                    const lfoGain = ctx.createGain();
                    lfoGain.gain.value = 10;
                    lfo.connect(lfoGain);
                    lfoGain.connect(v1.osc.frequency);
                    lfo.start();
                    return [v1, v2, { osc: lfo }];
                }
            };

            const playSynth = () => {
                stopSynth();
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const masterGain = ctx.createGain();
                masterGain.connect(ctx.destination);
                masterGain.gain.value = volume;

                const voices = synths[synthType](ctx, masterGain);
                synthRef.current = { ctx, masterGain, voices };
            };

            useEffect(() => {
                if (synthRef.current && synthRef.current.masterGain) {
                    synthRef.current.masterGain.gain.setTargetAtTime(volume, synthRef.current.ctx.currentTime, 0.1);
                }
            }, [volume]);

            const switchPreset = (newType) => {
                if (newType === synthType) return;
                setSwitching(true);
                setTimeout(() => setSwitching(false), 800);
                setSynthType(newType);
            };

            useEffect(() => {
                if (playing) {
                    playSynth();
                }
            }, [synthType]);

            useEffect(() => { return () => stopSynth(); }, []);

            const togglePlay = () => {
                if (playing) {
                    stopSynth();
                    setPlaying(false);
                } else {
                    playSynth();
                    setPlaying(true);
                }
            };

            return (
                <div className="w-full h-screen flex flex-col items-center justify-center animate-[fadeIn_1s_ease-in-out] relative">
                    <div className="absolute top-10 w-full max-w-4xl flex justify-between items-center px-4 z-20">
                        <h2 className="text-3xl text-stone-300 font-serif tracking-widest" style={{ fontFamily: '"Playfair Display"' }}>
                        The Midnight Waltz
                        </h2>
                        <button onClick={onBack} className="text-stone-500 hover:text-white transition-colors uppercase tracking-[0.2em] text-sm border-b border-transparent hover:border-white pb-1">Return</button>
                    </div>

                    <div className="relative w-full h-full flex flex-col items-center justify-center overflow-hidden">
                        {switching && (
                            <div className="absolute w-[200px] h-[200px] rounded-full border-2 border-emerald-500/50 animate-[ripple_1s_ease-out_forwards] z-10 pointer-events-none"></div>
                        )}

                        <div className={`transition-all duration-[3000ms] mb-12 ${playing ? 'opacity-100 scale-100' : 'opacity-20 scale-90 grayscale'}`}>
                            <div className="relative flex items-center justify-center">
                                <div className={`absolute w-[500px] h-[500px] rounded-full border border-stone-700/30 ${playing ? 'animate-[spin_20s_linear_infinite]' : ''}`}></div>
                                <div className={`absolute w-[400px] h-[400px] rounded-full border border-stone-600/40 border-dashed ${playing ? 'animate-[spin_15s_linear_infinite_reverse]' : ''}`}></div>
                                <div className={`absolute w-[300px] h-[300px] rounded-full border border-stone-500/20 ${playing ? 'animate-[spin_10s_linear_infinite]' : ''}`}></div>
                                <div className={`w-4 h-4 bg-emerald-900/50 rounded-full shadow-[0_0_50px_rgba(16,185,129,0.5)] ${playing ? 'animate-pulse' : ''}`}></div>
                            </div>
                        </div>

                        <div className="z-30 flex flex-col items-center gap-6 p-6 bg-black/40 backdrop-blur-md border border-stone-800 rounded-lg">
                            <button 
                                onClick={togglePlay}
                                className={`tracking-[0.5em] text-xs uppercase border px-10 py-4 transition-all duration-500 hover:scale-105 w-64
                                    ${playing 
                                        ? 'border-emerald-800 text-emerald-400 bg-emerald-900/10 shadow-[0_0_30px_rgba(16,185,129,0.2)]' 
                                        : 'border-stone-800 text-stone-400 hover:text-emerald-400 bg-black/40 hover:bg-white/5 hover:border-emerald-900/50'
                                    }`}
                            >
                                {playing ? "Silence The Music" : "Commence Dance"}
                            </button>

                            <div className="flex gap-4 text-xs tracking-widest uppercase text-stone-500">
                                <button 
                                    onClick={() => switchPreset('glass')} 
                                    className={`hover:text-white transition-colors ${synthType === 'glass' ? 'text-emerald-400 border-b border-emerald-900' : ''}`}
                                >
                                    Glass Armonica
                                </button>
                                <span className="opacity-20">|</span>
                                <button 
                                    onClick={() => switchPreset('alarm')} 
                                    className={`hover:text-white transition-colors ${synthType === 'alarm' ? 'text-red-400 border-b border-red-900' : ''}`}
                                >
                                    The Warning
                                </button>
                            </div>

                            <div className="w-full flex items-center gap-4">
                                <span className="text-stone-600 text-[10px] uppercase tracking-widest">Vol</span>
                                <input 
                                    type="range" 
                                    min="0" max="0.5" step="0.01" 
                                    value={volume} 
                                    onChange={(e) => setVolume(parseFloat(e.target.value))}
                                    className="w-full h-1 bg-stone-800 rounded-full appearance-none cursor-pointer"
                                />
                            </div>
                        </div>
                    </div>
                </div>
            )
        }

        // --- PAGE: Menu ---
        const MenuStrip = ({ text, delay, index, onClick }) => {
          const [showText, setShowText] = useState(false);
          useEffect(() => { const timer = setTimeout(() => { setShowText(true); }, delay); return () => clearTimeout(timer); }, [delay]);
          const filterId = `url(#grunge-filter-${(index % 3) + 1})`;
          return (
            <div onClick={onClick} className="relative group cursor-pointer w-full max-w-2xl mx-auto mb-8 transition-transform duration-500 hover:scale-[1.02]">
              <div className="relative h-24 w-full overflow-visible transition-all duration-700 ease-out bg-white/5 backdrop-blur-[8px] border border-white/10 shadow-[inset_0_0_20px_rgba(255,255,255,0.05)]" style={{ filter: filterId, clipPath: 'polygon(2% 4%, 98% 2%, 99% 96%, 1% 98%)', opacity: 0, animation: `fadeInStrip 1s ease-out forwards ${index * 0.2}s` }}><div className="absolute inset-0 bg-black opacity-[0.1] mix-blend-overlay pointer-events-none"></div></div>
              <div className="absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
                <h2 className={`text-3xl md:text-5xl font-serif tracking-widest uppercase text-gray-300 transition-all duration-[2000ms] ease-in-out group-hover:text-white group-hover:text-shadow-[0_0_15px_rgba(255,255,255,0.7)] ${showText ? 'opacity-90 blur-0 translate-y-0' : 'opacity-0 blur-sm translate-y-2'}`} style={{ fontFamily: '"Playfair Display", serif', textShadow: '0px 0px 5px rgba(0,0,0,0.8)' }}>{text}</h2>
              </div>
              <div className="absolute inset-0 opacity-0 group-hover:opacity-30 transition-opacity duration-500 bg-white/20 mix-blend-overlay pointer-events-none" style={{ filter: filterId }}></div>
            </div>
          );
        };

        // --- PAGE: Cursive Code Editor (Restored Full Content) ---
        const CursiveEditor = ({ onBack }) => {
          const rawCode = `async function fetchDarkSecrets() {
  // Get the location of the soul
  let infoid = new URL(window.location.href);
  const data = await getSecrets(infoid.pathname);
  
  // Apply the haunted effect
  useEffect(() => {
    // Get the HTMLCollection that holds each picture
    const imageTags = document
      .getElementsByClassName('article_content')[0]
      .getElementsByTagName('img');

    // Loop over the collection elements
    for (const item of imageTags) {
      item.style.filter = "grayscale(100%)";
      item.onclick = () => {
         revive(item);
      };
      
      // Watch for the shadows
      item.addEventListener('mouseenter', () => {
        playWhispers();
      });
    }
  }, []);

  // Return to the void
  return (
    <div className="void-container">
      {data.hasSecrets ? (
         <Reveal secrets={data} />
      ) : (
         <Vanish />
      )}
    </div>
  );
}`;

          const highlightLine = (text) => {
            if (!text) return " "; 
            let highlighted = text
              .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

            highlighted = highlighted.replace(/(\/\/.*)/g, '<span class="text-stone-500 italic font-light opacity-80" style="text-shadow: none;">$&</span>');
            highlighted = highlighted.replace(/\b(const|let|var|async|await|function|return|if|else|for|while|new|import|from|export|default|useEffect)\b/g, '<span class="text-cyan-400 font-medium drop-shadow-[0_0_5px_rgba(34,211,238,0.5)]">$&</span>');
            highlighted = highlighted.replace(/\.\w+(?=\()|\.\w+/g, '<span class="text-stone-200 italic opacity-90">$&</span>');
            highlighted = highlighted.replace(/(['"`])(.*?)\1/g, '<span class="text-emerald-400 font-normal drop-shadow-[0_0_2px_rgba(52,211,153,0.4)]">$&</span>');
            highlighted = highlighted.replace(/([{}()[\]=])/g, '<span class="text-white opacity-80 font-light">$&</span>');
            return highlighted;
          };

          const lines = rawCode.split('\n');

          return (
            <div className="w-full max-w-4xl mx-auto h-[80vh] flex flex-col animate-[fadeIn_1s_ease-in-out]">
              <div className="flex justify-between items-center mb-6 px-4">
                <h2 className="text-3xl text-red-900/80 font-serif tracking-widest" style={{ fontFamily: '"Playfair Display"' }}>Script Editor</h2>
                <button onClick={onBack} className="text-stone-400 hover:text-white transition-colors uppercase tracking-[0.2em] text-sm border-b border-transparent hover:border-white pb-1">Return</button>
              </div>

              <div className="relative flex-1 bg-black/40 backdrop-blur-md rounded-lg border border-white/10 shadow-[0_0_50px_rgba(0,0,0,0.5)] overflow-hidden flex flex-col">
                <div className="flex-1 overflow-auto no-scrollbar p-4">
                    <div className="grid grid-cols-[3rem_1fr] gap-x-4 font-mono text-lg" style={{ fontFamily: '"Cedarville Cursive", cursive' }}>
                        {lines.map((line, i) => (
                            <React.Fragment key={i}>
                                <div className="text-right text-stone-600 select-none leading-8 border-r border-white/5 pr-2">{i + 1}</div>
                                <div className="whitespace-pre-wrap break-words leading-8 text-[#d6d3d1]" dangerouslySetInnerHTML={{ __html: highlightLine(line) }} />
                            </React.Fragment>
                        ))}
                    </div>
                </div>
              </div>
            </div>
          );
        };

        // --- Key Listener ---
        const SecretListener = ({ onTrigger }) => {
          useEffect(() => {
            let pressed = new Set(); let timer = null;
            const checkCombo = () => { if (pressed.has('c') && pressed.has('o') && pressed.has('2')) { if (!timer) { timer = setTimeout(() => { onTrigger(); timer = null; }, 2000); } } else { if (timer) { clearTimeout(timer); timer = null; } } };
            const down = (e) => { pressed.add(e.key.toLowerCase()); checkCombo(); };
            const up = (e) => { pressed.delete(e.key.toLowerCase()); if (timer) { clearTimeout(timer); timer = null; } };
            window.addEventListener('keydown', down); window.addEventListener('keyup', up);
            return () => { window.removeEventListener('keydown', down); window.removeEventListener('keyup', up); if (timer) clearTimeout(timer); };
          }, [onTrigger]); return null;
        };

        // --- Main App ---
        function App() {
          const [view, setView] = useState('menu');
          const [showRegistry, setShowRegistry] = useState(false);
          const menuItems = [
            { text: "The Drawing Room", delay: 1500 },
            { text: "A Study in Scarlet", delay: 2500, action: () => setView('editor') },
            { text: "The Midnight Waltz", delay: 3500, action: () => setView('waltz') },
            { text: "Buried Secrets", delay: 4500, action: () => setView('secrets') },
            { text: "Depart", delay: 5500, action: () => setView('depart') }
          ];

          return (
            <div className="min-h-screen bg-[#050505] overflow-hidden relative selection:bg-emerald-900/30 selection:text-emerald-100">
              <GrungeFilters />
              <SecretListener onTrigger={() => setShowRegistry(true)} />
              {showRegistry && <RegistryModal onClose={() => setShowRegistry(false)} />}
              
              {/* Background Ambience */}
              <div className="fixed inset-0 pointer-events-none z-0">
                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-10 animate-pulse"></div>
                <div className="absolute inset-0 bg-gradient-radial from-transparent via-black/80 to-black opacity-90"></div>
                <div className="absolute inset-0 shadow-[inset_0_0_200px_rgba(0,0,0,1)]"></div>
                <div className="absolute inset-0 overflow-hidden">
                    {[...Array(50)].map((_, i) => (
                        <div key={i} className="absolute rounded-full bg-white mix-blend-overlay"
                            style={{ top: `${Math.random() * 100}%`, left: `${Math.random() * 100}%`, width: `${Math.random() * 3 + 1}px`, height: `${Math.random() * 3 + 1}px`, opacity: Math.random() * 0.5 + 0.1, animation: `float ${Math.random() * 20 + 10}s linear infinite`, animationDelay: `-${Math.random() * 20}s` }} />
                    ))}
                </div>
              </div>

              <main className="relative z-10 container mx-auto px-4 py-20 flex flex-col items-center justify-center min-h-screen transition-all duration-1000">
                {view === 'menu' && (
                    <>
                        <header className="mb-16 text-center opacity-50 animate-[fadeIn_2s_ease-in]">
                        <h1 className="text-stone-400 font-serif text-sm tracking-[0.5em] uppercase" style={{ fontFamily: '"Cinzel", serif' }}>Est. 1813</h1>
                        </header>
                        <div className="w-full flex flex-col items-center space-y-4">
                        {menuItems.map((item, index) => (
                            <MenuStrip key={index} index={index} text={item.text} delay={item.delay} onClick={item.action || (() => console.log(`Navigating to ${item.text}...`))} />
                        ))}
                        </div>
                    </>
                )}
                {view === 'editor' && <CursiveEditor onBack={() => setView('menu')} />}
                {view === 'waltz' && <MidnightWaltz onBack={() => setView('menu')} />}
                {view === 'secrets' && <BuriedSecrets onBack={() => setView('menu')} />}
                {view === 'depart' && <Depart onBack={() => setView('menu')} />}
              </main>
              <style>{`
                @keyframes fadeInStrip { 0% { opacity: 0; transform: scaleX(0.8) translateY(10px); } 100% { opacity: 1; transform: scaleX(1) translateY(0); } }
                @keyframes float { 0% { transform: translateY(0) translateX(0); opacity: 0; } 50% { opacity: 0.2; } 100% { transform: translateY(-100px) translateX(20px); opacity: 0; } }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
                @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
                @keyframes ripple { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }
                .text-shadow-\[0_0_15px_rgba\(255\,255\,255\,0\.7\)\] { text-shadow: 0 0 15px rgba(255, 255, 255, 0.7); }
              `}</style>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
